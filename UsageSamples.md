# CacheStressTester – Environment Usage Guide (Full Parameter Version)

## 1. Overview
`CacheStressTester` is a high-concurrency load generator for Redis (local or ElastiCache).  
It supports environment-driven configuration through **command-line arguments**, **environment variables**, or **Docker parameters**.  

This version uses a single **`RedisConnectionString`** instead of separate host/password flags and includes advanced runtime options for stress intensity, duration, and data patterns.

---

## 2. Command-Line Arguments

| Parameter | Type | Description | Example | Default |
|------------|------|-------------|----------|----------|
| `--Environment` | string | Target execution environment (`Local`, `AWS`, `Azure`, etc.) | `--Environment AWS` | `Local` |
| `--RedisConnectionString` | string | Redis endpoint and options (SSL, allowAdmin, etc.) | `"mycache.xxxxxx.cache.amazonaws.com:6379,ssl=true,allowAdmin=true"` | `localhost:6379` |
| `--DurationSeconds` | int | Test duration in seconds | `--DurationSeconds 60` | `15` |
| `--Threads` | int | Number of concurrent worker threads | `--Threads 300` | `30` |
| `--RequestsPerThread` | int | Number of operations per thread | `--RequestsPerThread 5000` | `200` |
| `--PayloadSizeBytes` | int | Size of the value payload (in bytes) for SET/WRITE ops | `--PayloadSizeBytes 2048` | `1024` |
| `--ReadWriteRatio` | float | Ratio of read vs write ops (0.0 = all writes, 1.0 = all reads) | `--ReadWriteRatio 0.7` | `0.5` |
| `--PublishMetrics` | bool | Enables publishing of internal metrics (e.g., CloudWatch) | `--PublishMetrics true` | `false` |
| `--AggressiveMode` | bool | Enables tighter concurrency timing and reduced delays | `--AggressiveMode true` | `true` |
| `--ShowProgress` | bool | Displays progress bar and periodic throughput | `--ShowProgress true` | `false` |
| `--Tag` *(optional)* | string | Label for the current execution (useful for logs and comparisons) | `--Tag HighLoadTest` | autogenerated |

---

## 3. Running Locally (Run Project / Visual Studio)

### Use Case
For development and controlled debugging of workload behavior.

### Steps
1. In Visual Studio → **Project Properties → Debug**, set:
   ```
   --Environment Local --RedisConnectionString "localhost:6379,allowAdmin=true" --Threads 50 --RequestsPerThread 1000 --DurationSeconds 30 --ShowProgress true
   ```
2. Optionally set environment variables for convenience:
   ```
   REDIS_CONNECTION_STRING=localhost:6379,allowAdmin=true
   DURATION_SECONDS=30
   THREADS=50
   ```
3. Press **F5** to run interactively.

### Recommended Local Settings
| Threads | Duration | Purpose |
|----------|-----------|----------|
| 30–50 | 15–30s | Logic verification, short bursts |
| 100–200 | 60s+ | Stability / resource analysis |

---

## 4. Running from Command Line (Executable)

### Use Case
For repeatable manual or scripted runs in QA/Cloud environments.

### Example
```bash
CacheStressTester.exe   --Environment AWS   --RedisConnectionString "mycache.xxxxxx.cache.amazonaws.com:6379,ssl=true,allowAdmin=true"   --Threads 500   --RequestsPerThread 20000   --PayloadSizeBytes 2048   --ReadWriteRatio 0.6   --DurationSeconds 120   --ShowProgress true   --AggressiveMode true   --Tag Run-HighCPU
```

### Notes
- Use **`AggressiveMode=false`** for slower, more realistic client pacing.  
- Use **`PublishMetrics=true`** only when CloudWatch integration is configured.  
- When authenticated in AWS (`cloud-tool`, `aws sso login`, or EC2 IAM Role), no password is needed.

---

## 5. Running Inside Docker

### Example Dockerfile
```dockerfile
FROM mcr.microsoft.com/dotnet/runtime:8.0
WORKDIR /app
COPY ./CacheStressTester .
ENTRYPOINT ["./CacheStressTester"]
```

### Run Example
```bash
docker run --rm cache-stresser   --Environment AWS   --RedisConnectionString "mycache.xxxxxx.cache.amazonaws.com:6379,ssl=true,allowAdmin=true"   --Threads 800   --RequestsPerThread 25000   --DurationSeconds 180   --PayloadSizeBytes 2048   --ReadWriteRatio 0.5   --AggressiveMode true   --Tag EC2-Test-01
```

### Environment Variable Alternative
```bash
docker run --rm   -e REDIS_CONNECTION_STRING="mycache.xxxxxx.cache.amazonaws.com:6379,ssl=true,allowAdmin=true"   -e THREADS=500   -e REQUESTS_PER_THREAD=10000   -e DURATION_SECONDS=60   -e PAYLOAD_SIZE_BYTES=1024   cache-stresser
```

---

## 6. Recommended Configurations

| Environment | Threads | Duration | Notes |
|--------------|----------|-----------|--------|
| **Local Dev** | 50–200 | 15–60s | For local verification |
| **QA / Test VM** | 300–500 | 60–180s | Monitored runs with CloudWatch |
| **EC2 / Stress Node** | 800–1200 | 120–300s | High-stress scenario, triggers alarms |
| **Distributed (Docker Swarm / K8s)** | 3–5 nodes × 500 threads | 60–120s | Simulates multi-client load |

---

## 7. Authentication and Security Notes

| Scenario | Example | Authentication |
|-----------|----------|----------------|
| **Local Redis** | `localhost:6379,allowAdmin=true` | No password |
| **ElastiCache (VPC secured)** | `mycache.xxxxxx.cache.amazonaws.com:6379,ssl=true,allowAdmin=true` | Network access only |
| **ElastiCache (AUTH token)** | `...,password=myToken123,ssl=true` | Only if AUTH enabled |
| **Docker on EC2** | Same as above | Access via VPC/IAM role |

> **Note:** ElastiCache does not use IAM credentials directly — it relies on secure VPC access or AUTH tokens.

---

## 8. Monitoring and Validation
Monitor CloudWatch metrics:
- `CPUUtilization`
- `CurrConnections`
- `CmdsProcessed`
- `Evictions`
- `FreeableMemory`

If **`PublishMetrics=true`**, the tool will attempt to push custom CloudWatch metrics (if implemented).  
Correlate these metrics with alarms from **Phase 2** and validations from **Phase 3**.

---

## 9. Best Practices
- Use **`AggressiveMode`** carefully — it removes intentional pacing delays.  
- Disable **`ShowProgress`** in CI/CD runs.  
- Keep **`PayloadSizeBytes`** ≤ 4096 unless testing memory stress.  
- Always prefer **SSL** for ElastiCache endpoints.  
- Store `RedisConnectionString` securely (e.g., environment variables or secret store).  
- Use distinct `--Tag` values for each run to help with tracking and analysis.

---
